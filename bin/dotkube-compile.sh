#!/bin/bash

KUBE_CONFIG_DIR=${1:-~/.kube}

mkdir -p ${KUBE_CONFIG_DIR}
export KUBECONFIG=$(find ${KUBE_CONFIG_DIR} -maxdepth 1 -type f,l | grep -v '/config' | grep -v '/kubectx' | tr '\n' ':')
echo "# This file was generated by ~/dotfiles/bin/dotkube-compile.sh, do not edit manually" > ${KUBE_CONFIG_DIR}/config
kubectl config view --flatten >> ${KUBE_CONFIG_DIR}/config
chmod o-rw ${KUBE_CONFIG_DIR}/config
chmod g-rw ${KUBE_CONFIG_DIR}/config
