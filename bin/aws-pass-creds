#!/usr/bin/env bash

# Usage: credential_process = aws-pass-creds <aws-vault-profile>
# retrieves amazon credentials for aws cli from pass storage backend
set -euo pipefail

PROFILE="$1"

# Export credentials to environment variables
eval "$(aws-vault export "$PROFILE")"

# Output JSON in the format expected by credential_process
cat <<EOF
{
  "Version": 1,
  "AccessKeyId": "$AWS_ACCESS_KEY_ID",
  "SecretAccessKey": "$AWS_SECRET_ACCESS_KEY",
  "SessionToken": "$AWS_SESSION_TOKEN",
  "Expiration": "$AWS_CREDENTIAL_EXPIRATION"
}
EOF
