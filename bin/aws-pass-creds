#!/usr/bin/env bash

# Usage: credential_process = aws-pass-creds <aws-vault-profile>
# retrieves amazon credentials for aws cli from pass storage backend

# you can also use directly in direnv with
# eval "$(aws-vault exec my-profile --duration=12h -- env | grep '^AWS_')"

set -euo pipefail

PROFILE="${1-}"

if [[ -z "$PROFILE" ]]; then
  echo "Error: missing required PROFILE argument" >&2
  exit 1
fi

aws-vault exec "$PROFILE" --json --duration=4h

## outputs kind of
#{
#  "Version": 1,
#  "AccessKeyId": "$AWS_ACCESS_KEY_ID",
#  "SecretAccessKey": "$AWS_SECRET_ACCESS_KEY",
#  "SessionToken": "$AWS_SESSION_TOKEN",
#  "Expiration": "$AWS_CREDENTIAL_EXPIRATION"
#}
